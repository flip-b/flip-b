<!-- Input -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'input'">
  <ion-item lines="none">
    <ion-label position="stacked">
      <div class="flb-item-title">{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}</div>
    </ion-label>

    <ng-container *ngIf="item._config.type !== 'textarea' && item._config.type !== 'richtext'">
      <ion-input [readonly]="item._config.readonly" [value]="item.value" [type]="item._config.inputType" [inputmode]="item._config.inputMode" placeholder="{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}" (ionFocus)="item.onEnter($event)" (ionBlur)="item.onLeave($event)" (ionInput)="item.onInput($event)" (keyup.enter)="item.onSubmit($event)"></ion-input>
    </ng-container>

    <ng-container *ngIf="item._config.type === 'textarea' || item._config.type === 'richtext'">
      <div class="menu" *ngIf="!item._config.readonly && item._config.inputMode === 'html'">
        <div *ngFor="let i of item._config._richItems" class="item {{ i.title }}" [ngClass]="{active: item._config._richUsing.includes(i.index)}" (click)="item._config._richOnClickItem(i)">{{ i.title }}</div>
      </div>
      <div class="text" [innerHTML]="item.value" attr.data-ph="{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}" contenteditable="true" spellcheck="false" (click)="item._config._richOnInput($event)" (keyup)="item._config._richOnInput($event)"></div>
    </ng-container>

    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'datetime'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" [trigger]="item._config.uuid">
        <ng-template
          ><ion-content><flb-item-datetime [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-datetime></ion-content
        ></ng-template>
      </ion-popover>
    </ng-container>

    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'location'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" [trigger]="item._config.uuid">
        <ng-template
          ><ion-content><flb-item-location [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-location></ion-content
        ></ng-template>
      </ion-popover>
    </ng-container>

    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'select'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" [trigger]="item._config.uuid">
        <ng-template
          ><ion-content><flb-item-select [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-select></ion-content
        ></ng-template>
      </ion-popover>
    </ng-container>

    <ng-container *ngIf="!item._config.readonly && item._config.type === 'checkbox'">
      <ion-checkbox slot="end" [checked]="item.value" (ionChange)="item.onChange($event)"></ion-checkbox>
    </ng-container>

    <ng-container *ngIf="!item._config.readonly && item._config.type === 'toggle'">
      <ion-toggle slot="end" [checked]="item.value" (ionChange)="item.onChange($event)"></ion-toggle>
    </ng-container>

    <ng-container *ngIf="item._config.icon">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.iconColor || 'medium'" title="{{ item._config.iconTitle || item._config.type + '.icon.title' || 'i18n' }}" [disabled]="item._config.iconDisabled" (click)="item.onClick($event)" [id]="item._config.uuid">
        <ion-icon slot="icon-only" [name]="item._config.icon" [style]="item._config.iconStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item._config.push && item.value === undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.pushColor || 'medium'" title="{{ item._config.pushTitle || item._config.type + '.push.title' || 'i18n' }}" [disabled]="item._config.pushDisabled" (click)="item._config._onPush()">
        <ion-icon slot="icon-only" [name]="item._config.push" [style]="item._config.pushStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item._config.drop && item.value !== undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.dropColor || 'medium'" title="{{ item._config.dropTitle || item._config.type + '.drop.title' || 'i18n' }}" [disabled]="item._config.dropDisabled" (click)="item._config._onDrop()">
        <ion-icon slot="icon-only" [name]="item._config.drop" [style]="item._config.dropStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-content></ng-content>
  </ion-item>

  <ng-container *ngIf="item.error">
    <div class="flb-item-error">{{ item._config.text[item.error] || item.error }}</div>
  </ng-container>
</ng-container>

<!-- Group -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'group'">
  <ion-item lines="none">
    <ion-label>
      <div class="flb-item-title">{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}</div>
      <div class="flb-item-label">{{ item._config.text.label || (item._config.path + '.label' | i18n) || '' }}</div>
    </ion-label>

    <ng-container *ngIf="item._config.push && item._config.show">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.pushColor || 'medium'" title="{{ item._config.pushTitle || item._config.type + '.push.title' || 'i18n' }}" [disabled]="item._config.pushDisabled" (click)="item._config._onPush()">
        <ion-icon slot="icon-only" [name]="item._config.push" [style]="item._config.pushStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item._config.drop && item._config.show">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.dropColor || 'medium'" title="{{ item._config.dropTitle || item._config.type + '.drop.title' || 'i18n' }}" [disabled]="item._config.dropDisabled" (click)="item._config._onDrop()">
        <ion-icon slot="icon-only" [name]="item._config.drop" [style]="item._config.dropStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item.value !== undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.iconColor || 'medium'" title="{{ (item._config.show ? 'hide.icon.title' : 'show.icon.title') || 'i18n' }}" (click)="item._config.show = !item._config.show">
        <ion-icon slot="icon-only" [name]="item._config.show ? 'chevron-up-circle' : 'chevron-down-circle'"></ion-icon>
      </ion-button>
    </ng-container>
  </ion-item>
  <ng-container *ngIf="item.value && item._config.show">
    <flb-form [form]="item.value"></flb-form>
  </ng-container>
</ng-container>

<!-- Array -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'array'">
  <ion-item lines="none">
    <ion-label>
      <div class="flb-item-title">{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}</div>
      <div class="flb-item-label">{{ item._config.text.label || (item._config.path + '.label' | i18n) || '' }}</div>
    </ion-label>

    <ng-container *ngIf="item._config.push && item._config.show">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.pushColor || 'medium'" title="{{ item._config.pushTitle || item._config.type + '.push.title' || 'i18n' }}" [disabled]="item._config.pushDisabled" (click)="item._config._onPush()">
        <ion-icon slot="icon-only" [name]="item._config.push" [style]="item._config.pushStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item._config.drop && item._config.show">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.dropColor || 'medium'" title="{{ item._config.dropTitle || item._config.type + '.drop.title' || 'i18n' }}" [disabled]="item._config.dropDisabled" (click)="item._config._onDrop()">
        <ion-icon slot="icon-only" [name]="item._config.drop" [style]="item._config.dropStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item.value !== undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.iconColor || 'medium'" title="{{ (item._config.show ? 'hide.icon.title' : 'show.icon.title') || 'i18n' }}" (click)="item._config.show = !item._config.show">
        <ion-icon slot="icon-only" [name]="item._config.show ? 'chevron-up-circle' : 'chevron-down-circle'"></ion-icon>
      </ion-button>
    </ng-container>
  </ion-item>
  <ng-container *ngIf="item.value && item._config.show">
    <flb-form [form]="form" *ngFor="let form of item.value; let index = index">
      <ng-container *ngIf="item._config.drop">
        <ion-button slot="end" fill="clear" tabindex="-1" [color]="item._config.dropColor || 'medium'" title="{{ item._config.dropTitle || item._config.type + '.drop.title' || 'i18n' }}" [disabled]="item._config.dropDisabled" (click)="item._config._onDropIndex(index)">
          <ion-icon slot="icon-only" [name]="item._config.drop" [style]="item._config.dropStyle || undefined"></ion-icon>
        </ion-button>
      </ng-container>
    </flb-form>
  </ng-container>
</ng-container>

<!-- Value -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'value' && item.value">
  <ion-item lines="none" [button]="item.value.index !== undefined" [detail]="false" (click)="item.value.index !== undefined ? item.onSelect($event) : null">
    <ng-container *ngIf="item.value.image !== undefined || item.value.state !== undefined">
      <ion-thumbnail slot="start">
        <img class="flb-item-image" *ngIf="item.value.image" [src]="item.value.image" (error)="data._onLoadImageError($event)" />
        <div class="flb-item-icon" *ngIf="!item.value.image"><ion-icon [name]="item.value.icon || 'camera'"></ion-icon></div>
        <div class="flb-item-state" *ngIf="item.value.state !== undefined" [ngClass]="{success: item.value.state, danger: !item.value.state}"></div>
      </ion-thumbnail>
    </ng-container>

    <ng-container *ngIf="item.value.title !== undefined || item.value.label !== undefined">
      <ion-label>
        <div class="flb-item-title" *ngIf="item.value.title !== undefined">{{ item.value.title }}</div>
        <div class="flb-item-label" *ngIf="item.value.label !== undefined">{{ item.value.label }}</div>
        <div class="flb-item-count" *ngIf="item.value.count !== undefined">{{ item.value.count }}</div>
        <div class="flb-item-total" *ngIf="item.value.total !== undefined">{{ item.value.total }}</div>
      </ion-label>
    </ng-container>

    <ng-container *ngIf="item.value.notes !== undefined">
      <ion-label>
        <div class="flb-item-notes" *ngFor="let note of item.value.notes">{{ note }}</div>
      </ion-label>
    </ng-container>

    <ng-container *ngIf="item.value.search !== undefined">
      <ion-searchbar [(ngModel)]="item._config.query" placeholder="{{ 'query' || 'i18n' }}" (ionChange)="(null)"></ion-searchbar>
    </ng-container>

    <ng-container *ngIf="item.value.menu !== undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" color="medium" title="{{ '.menu' || 'i18n' }}" class="ion-hide-lg-up" (click)="data.showMenu($event)">
        <ion-icon slot="icon-only" name="menu"></ion-icon>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="item.value.menu !== undefined && item.value.modal !== undefined">
      <ion-button slot="end" fill="clear" tabindex="-1" color="medium" title="{{ '.cancel' || 'i18n' }}" (click)="item.value.modal.dismiss()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ng-container>
  </ion-item>
</ng-container>

<!-- Field -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'field'">
  <ion-item lines="none" [button]="['button', 'submit', 'cancel'].includes(item._config.type)" [detail]="false" [disabled]="item._config.iconDisabled" (click)="item.onClick($event)" class="{{ item._config.iconOnly ? 'flb-item-button-icon' : 'flb-item-button-text' }}" title="{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}">
    <ng-container *ngIf="item._config.icon && item._config.iconOnly">
      <ion-icon [name]="item._config.icon" [color]="item._config.iconColor || 'medium'" [style]="item._config.iconStyle || undefined"></ion-icon>
    </ng-container>

    <ng-container *ngIf="item._config.icon && !item._config.iconOnly">
      <ion-icon [name]="item._config.icon" [color]="item._config.iconColor || 'medium'" [style]="item._config.iconStyle || undefined" slot="start"></ion-icon>
    </ng-container>

    <ng-container *ngIf="item._config.text && !item._config.iconOnly && ['header', 'footer', 'legend', 'button', 'submit', 'cancel'].includes(item._config.type)">
      <ion-label>
        <div class="flb-item-title">{{ item._config.text.title || (item._config.path + '.title' | i18n) || item._config.name }}</div>
      </ion-label>
    </ng-container>
  </ion-item>
</ng-container>
