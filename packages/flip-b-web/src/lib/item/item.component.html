<!-- Input -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'input'">
  <ion-item lines="none">
    <ng-container *ngIf="item._config.text.title">
      <ion-label position="stacked">
        <div class="flb-item-title" *ngIf="item._config.text.title">{{ item._config.text.title }}</div>
      </ion-label>
    </ng-container>
    <ng-container *ngIf="item._config.type !== 'textarea' && item._config.type !== 'richtext'">
      <ion-input [readonly]="item._config.readonly" [value]="item.value" [type]="item._config.inputType" [inputmode]="item._config.inputMode" [placeholder]="item._config.text.message" (ionFocus)="item.onEnter($event)" (ionBlur)="item.onLeave($event)" (ionInput)="item.onInput($event)" (keyup.enter)="item.onSubmit($event)"></ion-input>
    </ng-container>
    <ng-container *ngIf="item._config.type === 'textarea' || item._config.type === 'richtext'">
      <div class="menu" *ngIf="!item._config.readonly && item._config.inputMode === 'html'"><div *ngFor="let item of items" class="item {{ item.title }}" [ngClass]="{active: using.includes(item.index)}" (click)="onClickItem(item)">{{ item.title }}</div></div>
      <div class="text" [innerHTML]="item.value" contenteditable="true" spellcheck="false" (click)="onInput($event)" (keyup)="onInput($event)"></div>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'datetime'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" trigger="{{ item._config.uuid }}">
        <ng-template><ion-content><flb-item-datetime [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-datetime></ion-content></ng-template>
      </ion-popover>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'location'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" trigger="{{ item._config.uuid }}">
        <ng-template><ion-content><flb-item-location [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-location></ion-content></ng-template>
      </ion-popover>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item._config.inputPicker === 'select'">
      <ion-popover #modal class="flb" [showBackdrop]="false" [arrow]="false" side="left" trigger="{{ item._config.uuid }}">
        <ng-template><ion-content><flb-item-select [modal]="modal" [item]="item" (onApply)="item.onInput($event)"></flb-item-select></ion-content></ng-template>
      </ion-popover>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item._config.type === 'checkbox'">
      <ion-checkbox slot="end" [checked]="item.value" (ionChange)="item.onChange($event)"></ion-checkbox>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item._config.type === 'toggle'">
      <ion-toggle slot="end" [checked]="item.value" (ionChange)="item.onChange($event)"></ion-toggle>
    </ng-container>
    <ng-container *ngIf="item._config.icon">
      <ion-button slot="end" fill="clear" [color]="item._config.color || 'medium'" title="{{ 'icon.' + item._config.icon + '.title' | i18n }}" [disabled]="item._config.iconDisabled" (click)="item.onClick($event)" id="{{ item._config.uuid }}">
        <ion-icon slot="icon-only" [name]="item._config.icon" [style]="item._config.iconStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-container *ngIf="item._config.drop && item.value">
      <ion-button slot="end" fill="clear" [color]="item._config.dropColor || 'medium'" title="{{ 'icon.' + item._config.drop + '.title' | i18n }}" [disabled]="item._config.dropDisabled" (click)="item.setValue(undefined)">
        <ion-icon slot="icon-only" [name]="item._config.drop" [style]="item._config.dropStyle || undefined"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-content></ng-content>
  </ion-item>
  <ng-container *ngIf="item.error">
    <div class="flb-item-error">{{ item._config.text[item.error] || item.error }}</div>
  </ng-container>
</ng-container>

<!-- Group -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'group'">
  <ion-item lines="none">
    <ng-container *ngIf="item._config.text.title || item._config.text.label">
      <ion-label>
        <div class="flb-item-title" *ngIf="item._config.text.title">{{ item._config.text.title }}</div>
        <div class="flb-item-label" *ngIf="item._config.text.label">{{ item._config.text.label }}</div>
      </ion-label>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item.value">
      <ion-button slot="end" fill="clear" color="medium" (click)="item._config.collapse = !item._config.collapse">
        <ion-icon slot="icon-only" [name]="item._config.collapse ? 'chevron-down-circle' : 'chevron-up-circle'"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item.value">
      <ion-button slot="end" fill="clear" color="danger" (click)="item._config.inputGroupDrop()">
        <ion-icon slot="icon-only" name="remove-circle"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && !item.value">
      <ion-button slot="end" fill="clear" color="medium" (click)="item._config.inputGroupPush()">
        <ion-icon slot="icon-only" name="add-circle"></ion-icon>
      </ion-button>
    </ng-container>
  </ion-item>
  <ng-container *ngIf="item.value && !item._config.collapse">
    <flb-form [form]="item.value"></flb-form>
  </ng-container>
</ng-container>

<!-- Array -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'array'">
  <ion-item lines="none">
    <ng-container *ngIf="item._config.text.title || item._config.text.label">
      <ion-label>
        <div class="flb-item-title" *ngIf="item._config.text.title">{{ item._config.text.title }}</div>
        <div class="flb-item-label" *ngIf="item._config.text.label">{{ item._config.text.label }}</div>
      </ion-label>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item.value?.length">
      <ion-button slot="end" fill="clear" color="medium" (click)="item._config.collapse = !item._config.collapse">
        <ion-icon slot="icon-only" [name]="item._config.collapse ? 'chevron-down-circle' : 'chevron-up-circle'"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly">
      <ion-button slot="end" fill="clear" color="medium" (click)="item._config.inputArrayPush()">
        <ion-icon slot="icon-only" name="add-circle"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-container *ngIf="!item._config.readonly && item.value?.length">
      <ion-button slot="end" fill="clear" color="danger" (click)="item._config.inputArrayDrop()">
        <ion-icon slot="icon-only" name="remove-circle"></ion-icon>
      </ion-button>
    </ng-container>
  </ion-item>
  <ng-container *ngIf="item.value && !item._config.collapse">
    <flb-form [form]="form" *ngFor="let form of item.value; let index = index">
      <ion-button *ngIf="!item._config.readonly" slot="end" fill="clear" color="medium" (click)="item._config.inputArrayDropByIndex(index)">
        <ion-icon slot="icon-only" name="remove-circle"></ion-icon>
      </ion-button>
    </flb-form>
  </ng-container>
</ng-container>

<!-- Value -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'value'">
  <ion-item lines="none" [button]="true" [detail]="false" (click)="item.onSelect($event)">
    <ng-container *ngIf="item._config.text.title">
      <ion-label position="stacked">
        <div class="flb-item-title" *ngIf="item._config.text.title">{{ item._config.text.title }} {{ item._config.uuid }}</div>
      </ion-label>
    </ng-container>
    <ng-container *ngIf="item._config.image !== undefined || item._config.state !== undefined || item._config.icon !== undefined">
      <ion-thumbnail slot="start">
        <img class="flb-item-image" *ngIf="item._config.image" [src]="item._config.image" (error)="item._context.page.onLoadImageError($event)">
        <div class="flb-item-icon" *ngIf="!item._config.image"><ion-icon [name]="item._config.icon || 'camera'"></ion-icon></div>
        <div class="flb-item-state" *ngIf="item._config.state !== undefined" [ngClass]="{success: item._config.state, danger: !item._config.state}"></div>
      </ion-thumbnail>
    </ng-container>
    <ng-container *ngIf="item._config.index !== undefined || item._config.title !== undefined || item._config._id !== undefined">
      <ion-label>
        <div class="flb-item-title" *ngIf="item._config.index !== undefined && !item._config.title && !item._config.label">{{ (item._config.index | i18n) || item._config.index }}</div>
        <div class="flb-item-title" *ngIf="item._config.title !== undefined">{{ item._config.title }}</div>
        <div class="flb-item-label" *ngIf="item._config.label !== undefined">{{ item._config.label }}</div>
        <div class="flb-item-count" *ngIf="item._config.count !== undefined">{{ item._config.count | i18n: 'integer' }}</div>
        <div class="flb-item-total" *ngIf="item._config.total !== undefined">{{ item._config.total | i18n: 'decimal' }}</div>
      </ion-label>
    </ng-container>
    <ng-container *ngIf="item._config.notes !== undefined">
      <ion-label>
        <div class="flb-item-notes" *ngFor="let note of item._config.notes">{{ note }}</div>
      </ion-label>
    </ng-container>
  </ion-item>
</ng-container>

<!-- Field -->
<ng-container *ngIf="item?._config?.init && item._config.mode === 'field'">
  <ng-container *ngIf="item._config.type === 'upload'">
    <ion-thumbnail (click)="item.onClick($event)">
      <img class="flb-item-image" *ngIf="item.value" [src]="item.value" (error)="item._context.page.onLoadImageError($event)">
      <div class="flb-item-icon" *ngIf="!item.value"><ion-icon [name]="item._config.icon || 'camera'"></ion-icon></div>
    </ion-thumbnail>
  </ng-container>
  <ng-container *ngIf="['header', 'footer', 'legend'].includes(item._config.type)">
    <ion-label>
      <div class="flb-item-title" *ngIf="item._config.text.title">{{ item._config.text.title }}</div>
      <div class="flb-item-label" *ngIf="item._config.text.label">{{ item._config.text.label }}</div>
      <div class="flb-item-value" *ngIf="item.value">{{ item.value | i18n: (item._config.cast || item._config.type) }}</div>
    </ion-label>
  </ng-container>
  <ng-container *ngIf="['button', 'submit', 'cancel'].includes(item._config.type)">
    <ion-button [class]="'flb-button-' + (item._config.iconOnly ? 'icon' : 'text')" expand="block" [fill]="item._config.fill" [color]="item._config.color || 'light'" [title]="item._config.text?.title || ''" [disabled]="item._config.iconDisabled" (click)="item.onClick($event)" id="{{ item._config.uuid || '' }}">
      <ion-icon *ngIf="item._config.icon" [slot]="item._config.iconOnly ? 'icon-only' : 'start'" [name]="item._config.icon || 'search'"></ion-icon>
      <ion-text *ngIf="!item._config.iconOnly">{{ item._config.text?.title || item._config.text?.label }}</ion-text>
    </ion-button>
  </ng-container>
  <!--
  <ng-container>
    <ion-searchbar [(ngModel)]="page._config.query" placeholder="{{ page._config.name + '.title' | i18n }}" (ionChange)="null"></ion-searchbar>
  </ng-container>
  <ng-container *ngIf="modal">
    <ion-button slot="end" fill="clear" color="medium" title="{{ page._config.name + '.cancel.title' | i18n }}" (click)="modal.dismiss()">
      <ion-icon slot="icon-only" name="close"></ion-icon>
    </ion-button>
  </ng-container>
  <ng-container *ngIf="!modal">
    <ion-button slot="end" fill="clear" color="medium" title="{{ page._config.name + '.global.menu' | i18n }}" class="ion-hide-lg-up" (click)="item._context.page.menuController.open()">
      <ion-icon slot="icon-only" name="menu"></ion-icon>
    </ion-button>
  </ng-container>
  -->
</ng-container>
